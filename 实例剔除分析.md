# 实例剔除
Render函数中的InstanceCullingManager负责管理实例剔除，它收集场景中的实例数据，并执行剔除操作，以优化渲染性能。

1. InstanceCullingManager初始化

        FInstanceCullingManager& InstanceCullingManager = *GraphBuilder.AllocObject<FInstanceCullingManager>(GraphBuilder, *Scene, GetSceneUniforms(), ViewDataManager);
    这里，InstanceCullingManager被分配在GraphBuilder上，并传入Scene、SceneUniforms和ViewDataManager作为参数。

        BeginInitViews(GraphBuilder, SceneTexturesConfig, InstanceCullingManager, ExternalAccessQueue, InitViewTaskDatas)
    在BeginInitViews中，会进行视图初始化，包括
    * 收集场景中所有可见的实例数据
    * 建立实例的可见性信息
    * 准备后续的剔除操作
2. GPU场景准备

    * Scene->GPUScene.UploadDynamicPrimitiveShaderDataForView(GraphBuilder, View);
    * ViewDataManager.InitInstanceState(GraphBuilder);
    * GetSceneExtensionsRenderers().UpdateViewData(GraphBuilder, ViewDataManager);
    * GetSceneExtensionsRenderers().UpdateSceneUniformBuffer(GraphBuilder, GetSceneUniforms());

    动态图元刷新，初始化实例状态，刷新能见度状态，刷新场景UniformBuffer。
3. 开始剔除

        InstanceCullingManager.BeginDeferredCulling(GraphBuilder);
    * 收集所有需要剔除的实例
    * 准备GPU剔除所需的数据结构
    * 设置剔除管线
4. 后续使用
    * PrePass

            RenderPrePass(GraphBuilder, InViews, SceneTextures.Depth.Target, InstanceCullingManager, &FirstStageDepthBuffer);
    * BasePass

            RenderBasePass(*this, GraphBuilder, CustomRenderPassViews, SceneTextures, DBufferTextures, BasePassDepthStencilAccess, /*ForwardScreenSpaceShadowMaskTexture=*/nullptr, InstanceCullingManager, bNaniteEnabled, NaniteBasePassShadingCommands, NaniteRasterResults);

    * 半透明

            RenderTranslucency(*this, GraphBuilder, SceneTextures, TranslucencyLightingVolumeTextures, &TranslucencyResourceMap, Views, ETranslucencyView::UnderWater, 
            SeparateTranslucencyDimensions, InstanceCullingManager, 
            bStandardTranslucentCanRenderSeparate, TranslucencySharedDepthTexture);

    * DynamicShadow

            FinishInitDynamicShadows(GraphBuilder, InitViewTaskDatas.DynamicShadows, InstanceCullingManager);
